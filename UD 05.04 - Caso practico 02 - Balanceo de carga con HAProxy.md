# UD 05.04 - Caso practico 02 - Balanceo de carga con HAProxy

Crear directorios:

<img width="715" height="150" alt="captura 1 haproxy" src="https://github.com/user-attachments/assets/b3c6673a-666c-434f-aabf-0b193125e160" />

Dentro de cada directorio se agrega lo siguiente:

<img width="552" height="95" alt="captura 2 haproxy" src="https://github.com/user-attachments/assets/18220775-9c9d-493a-984b-58d8d4b2de43" />

<img width="550" height="74" alt="captura 3 haproxy" src="https://github.com/user-attachments/assets/0f5936b6-543b-49ef-a127-ab2102b3425f" />

Siguiente paso montarlo:

<img width="886" height="686" alt="captura 4 haproxy" src="https://github.com/user-attachments/assets/198b85e2-a828-4935-b03e-936aa0aeca00" />

Y dentro volvemos a agregar pero ahora en el apache02:

<img width="564" height="94" alt="captura 5 haproxy" src="https://github.com/user-attachments/assets/5ab724fc-770a-4ee3-954b-08bd38efaefd" />

<img width="546" height="75" alt="captura 6 haproxy" src="https://github.com/user-attachments/assets/99ed5b7d-95e8-4325-b5aa-158cb263572d" />

Y volvemos a montar este:

<img width="775" height="218" alt="captura 7 haproxy" src="https://github.com/user-attachments/assets/23b1a65c-24ca-4305-86b7-12b354cb80c2" />

Volvemos a hacer lo mismo con el directorio proxy:

<img width="554" height="100" alt="captura 8 haproxy" src="https://github.com/user-attachments/assets/644b3061-f56d-4ef7-98f3-0e034dd7c055" />

<img width="553" height="311" alt="captura 9 haproxy" src="https://github.com/user-attachments/assets/a15cc6cd-b645-4d39-8c8a-01b7808fbcd4" />

Y lo montamos:

<img width="775" height="688" alt="captura 10 haproxy" src="https://github.com/user-attachments/assets/3daab97e-33bf-426b-9734-19f7f0998632" />

En primer lugar, creamos la red “balanceo” con el siguiente comando:
docker network create balanceo

<img width="598" height="59" alt="captura 11 haproxy" src="https://github.com/user-attachments/assets/474dba6d-2710-41ce-8e6d-bc14d953f2a9" />

A continuación, creamos los servidores Apache dentro de la red “balanceo” y les damos como
nombres “ap01” y “ap02”. Esos nombres posteriormente serán pasados como IP/HOST para el
servidor HAProxy. Los comandos para crearlos son:

<img width="816" height="89" alt="captura 12 haproxy" src="https://github.com/user-attachments/assets/53ceef67-4517-4555-bd51-10aeed3d8ebc" />

Creamos el contenedor con HAProxy con nombre “ha01”, dentro de la red “balanceo” y con el
puerto 80 del servidor HAProxy se mapeará con el puerto 8080 de la máquina anfitrión.
Lo creamos con este contenedor:

<img width="1203" height="77" alt="captura 13 haproxy" src="https://github.com/user-attachments/assets/99b6743a-e432-41c5-aedc-f8e63be93203" />

Con el sudo docker ps comprobamos:

<img width="887" height="95" alt="Screenshot_20260126_120851" src="https://github.com/user-attachments/assets/ab2b6461-39b7-4212-bf97-9733978cb9ec" />

<img width="766" height="96" alt="Screenshot_20260126_121102" src="https://github.com/user-attachments/assets/3884ccdf-da4f-4e9f-90a7-db82c039abcc" />

Accediendo en nuestra máquina anfitriona a http://localhost:8080 si todo ha funcionado bien
observaremos las siguientes pantallas, que irán cambiando según recarguemos la página, ya que a
cada recarga le atenderá a la petición un servidor diferente:
Apache01:

<img width="923" height="381" alt="Screenshot_20260126_122019" src="https://github.com/user-attachments/assets/ed78f382-d0e9-40ad-9c5c-9336da2435ae" />

Detenemos y eliminamos los anteriores contenedores “ap01” y ap02”
docker stop ap01 ap02
docker rm ap01 ap02

<img width="455" height="168" alt="captura 14 haproxy" src="https://github.com/user-attachments/assets/84f63a3a-8b74-4d32-b156-b038c8e51675" />

Y modificamos despues el apache :

<img width="923" height="381" alt="Screenshot_20260126_122019" src="https://github.com/user-attachments/assets/9aaf6b3b-1543-41a5-8b04-50a11cdb6ed8" />
